# リスト画面におけるノードリンク（派生関係）表現提案書

> **Version**: 1.0.0
> **Created**: 2026-02-02
> **Author**: ashigaru6（デザイナー任務）
> **Status**: チーム検討用

---

## 背景と課題

InspireHubの核心機能は「アイデア同士のリンク（派生関係）」である。
現在のホーム画面（リスト表示）では `NodeCardView` がフラットに並んでおり、
各ノード間の派生関係は一切可視化されていない。

ユーザーがリスト画面で「このアイデアは何から派生したのか」「どれだけ広がっているのか」を
直感的に把握できれば、閲覧→リアクション→派生投稿への段階的エンゲージメントが加速する。

### 現状の実装

```
NodeCardView（現在）
┌─────────────────────────────┐
│ 💡 アイデア          2時間前  │
│ タイトルタイトル              │
│ 本文のプレビュー...           │
└─────────────────────────────┘
```

- `Node.parentNodeId: String?` で派生元を保持
- 詳細画面（DetailView）では親ノード・子ノードを表示済み
- **リスト画面では派生関係の情報がゼロ**

### ドメインモデル上の制約

- 派生関係は **単方向の親子関係**（parentNodeId）
- 1つのノードは最大1つの親を持つ（N:1）
- 1つのノードは複数の子を持てる（1:N）
- 双方向リンクや多対多リンクは Phase1 では存在しない

---

## 提案一覧

| # | 提案名 | コンセプト | SwiftUI実装難度 |
|---|--------|-----------|----------------|
| 1 | リンクバッジ方式 | カード内に派生情報バッジ追加 | ★☆☆☆ |
| 2 | スレッドグルーピング方式 | 親子をグループ化して表示 | ★★☆☆ |
| 3 | コネクションライン方式 | カード間を縦線で接続 | ★★★☆ |
| 4 | ミニグラフ・プレビュー方式 | カード内に小さな関係図 | ★★★☆ |
| 5 | ブレッドクラム＋展開方式 | 派生元パスと子ノード展開 | ★★☆☆ |

---

## 提案 1: リンクバッジ方式（Link Badge）

### コンセプト

既存の `NodeCardView` に最小限の派生情報バッジを追加する。
カードのレイアウトをほぼ変えず、「このノードは孤立していない」ことだけを伝える。

### ビジュアル

```
┌─────────────────────────────┐
│ 💡 アイデア          2時間前  │
│ タイトルタイトル              │
│ 本文のプレビュー...           │
│                             │
│ ↑ 派生元あり    ↓ 派生 3件   │  ← 新規追加行
└─────────────────────────────┘
```

- **派生元あり**: `parentNodeId != nil` の場合に `↑ 派生元あり` を表示
- **派生N件**: 子ノード数を `↓ 派生 N件` で表示
- タップで詳細画面の該当セクションへジャンプ

### SwiftUI実装イメージ

```swift
// NodeCardView に追加
HStack(spacing: 12) {
    if node.parentNodeId != nil {
        Label("派生元あり", systemImage: "arrow.turn.left.up")
            .font(.caption2)
            .foregroundColor(.blue)
    }
    if childCount > 0 {
        Label("派生 \(childCount)件", systemImage: "arrow.turn.right.down")
            .font(.caption2)
            .foregroundColor(.orange)
    }
}
```

### 必要なデータ

- `Node.parentNodeId`（既存）
- `childCount: Int`（**要追加**: HomeViewModel で各ノードの子ノード数を取得）

### 長所

- 既存UIへの影響が最小。レイアウト変更なし
- 実装コストが極めて低い
- リストのスクロール性能に影響なし
- ユーザーに「つながりがある」ことを最低限伝えられる

### 短所

- 関係の深さ・広がりは伝わらない（「3件」としか分からない）
- 派生元の内容（タイトル等）が見えない
- 「つながりの面白さ」を訴求する力が弱い

### マップ画面との連携

- バッジタップ → マップ画面の該当ノード中心表示に遷移（Phase2）
- バッジの色をマップ上のエッジ色と統一

### ペルソナ評価

中村大輔（31歳）にとって：
- **良い点**: 情報過多にならず、気軽にスクロールできる。「軽い関与」の姿勢に合う
- **懸念**: 派生関係の面白さが伝わりにくく、派生投稿への動機づけが弱い

---

## 提案 2: スレッドグルーピング方式（Thread Grouping）

### コンセプト

TwitterのスレッドやSlackのスレッド返信のように、
親ノードの下に派生ノードをインデント表示でグループ化する。
デフォルトは折りたたみ、タップで展開。

### ビジュアル

```
┌─────────────────────────────┐
│ 📝 課題              1日前   │
│ リモートワークの孤立感        │
│ 在宅勤務で雑談がなく...       │
│              ↓ 派生 2件 ▼    │  ← 展開トグル
├─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─┤
│  ┊ 💡 雑談チャンネル自動生成   │  ← インデント＋縦線
│  ┊    リアクション: 👍 5      │
│  ┊ 💡 バーチャルオフィス導入    │
│  ┊    リアクション: 👍 12     │
└─────────────────────────────┘

┌─────────────────────────────┐
│ 💡 アイデア          3時間前  │  ← 別の独立ノード
│ 社食メニュー投票システム      │
│ ...                         │
└─────────────────────────────┘
```

- 親カードの下に子ノードをコンパクト表示（タイトル＋リアクション数のみ）
- 左端に縦の点線でグループを視覚的に接続
- デフォルトは折りたたみ。「↓ 派生 N件 ▼」タップで展開

### SwiftUI実装イメージ

```swift
ForEach(groupedNodes, id: \.parent.id) { group in
    VStack(spacing: 0) {
        NodeCardView(node: group.parent)

        if group.children.count > 0 {
            DisclosureGroup("派生 \(group.children.count)件") {
                ForEach(group.children, id: \.id) { child in
                    CompactNodeRow(node: child)
                        .padding(.leading, 24)
                }
            }
            .padding(.horizontal, 14)
            .padding(.bottom, 8)
        }
    }
    .background(Color(.secondarySystemBackground))
    .cornerRadius(12)
}
```

### 必要なデータ

- 全ノードの parentNodeId から親子グルーピングを構築
- HomeViewModel に `groupedNodes: List<NodeGroup>` を追加

### 長所

- 親子関係が一目瞭然。「何から何が生まれたか」がリスト上で把握できる
- 折りたたみにより、興味がないスレッドはスキップできる
- Twitterスレッド的UIで馴染みがある
- 「派生されている＝盛り上がっている」ことが自然に伝わる

### 短所

- ソート順との整合が複雑（新着順でグルーピングすると親が古い位置に留まる問題）
- 深いネスト（孫→曾孫）をどう扱うか設計が必要
- 独立ノード（派生なし）とグループ化ノードで見た目に差が出る
- グルーピングロジックの追加実装が必要

### マップ画面との連携

- スレッド展開時のビジュアルはマップのサブツリーに対応
- スレッドグループ全体をタップ → マップでそのクラスタをハイライト

### ペルソナ評価

中村大輔にとって：
- **良い点**: 「他の人の課題にこんな解決案が出てるんだ」が見える。派生投稿への心理的ハードルが下がる
- **懸念**: グルーピングにより一画面の情報量が増え、「軽く眺める」体験が少し重くなる

---

## 提案 3: コネクションライン方式（Connection Line）

### コンセプト

リスト内で派生関係にあるカード同士を、左側の縦ラインで視覚的に接続する。
GitのブランチグラフやGitHub のコミット履歴のような表現。

### ビジュアル

```
  ●─ ┌─────────────────────────┐
  │  │ 📝 課題: リモートの孤立感  │
  │  └─────────────────────────┘
  │
  ├─ ┌─────────────────────────┐
  │  │ 💡 雑談チャンネル自動生成   │
  │  └─────────────────────────┘
  │
  └─ ┌─────────────────────────┐
     │ 💡 バーチャルオフィス導入   │
     └─────────────────────────┘

  ●─ ┌─────────────────────────┐
     │ 💡 社食メニュー投票        │  ← 独立ノード
     └─────────────────────────┘
```

- 左マージンにGitグラフ風の線を描画
- ルートノード: `●`（塗りつぶし丸）
- 子ノード: `├` or `└` で分岐表示
- 独立ノード（parentNodeId == nil かつ子なし）: `●` のみ

### SwiftUI実装イメージ

```swift
HStack(alignment: .top, spacing: 0) {
    // 左側: コネクションライン
    ConnectionLineView(
        nodePosition: position, // .root, .middle, .last, .standalone
        hasChildren: hasChildren
    )
    .frame(width: 32)

    // 右側: カード本体
    NodeCardView(node: node)
}
```

```swift
struct ConnectionLineView: View {
    let nodePosition: NodePosition
    let hasChildren: Bool

    var body: some View {
        Canvas { context, size in
            let midX = size.width / 2
            // 縦線・横線・ドットをCanvasで描画
            // nodePosition に応じてパスを変更
        }
    }
}
```

### 必要なデータ

- ノードを派生ツリー順にソートするロジック
- 各ノードのツリー内位置（root / middle / last / standalone）

### 長所

- 派生関係の構造が最も直感的に可視化される
- Gitユーザー（エンジニア）には馴染み深い表現
- マップ画面の「線でつなぐ」表現との親和性が高い
- スクロールしても関係が追える

### 短所

- リスト表示順が派生ツリー順に固定される（新着順・人気順ソートとの併用が困難）
- 左マージンの分だけカード幅が狭くなる
- 複雑な分岐（1ノードから5件派生など）で線が混雑する
- Canvas描画のパフォーマンスに注意が必要（LazyVStack内での再描画）

### マップ画面との連携

- コネクションラインの色 ＝ マップのエッジ色を統一
- コネクションラインをタップ → マップの該当エッジにフォーカス

### ペルソナ評価

中村大輔にとって：
- **良い点**: Gitを日常的に使うエンジニアなので、ブランチ表現は直感的に読める
- **懸念**: ソートの自由度が下がる。「新着順で軽く眺める」という利用シナリオと相性が悪い

---

## 提案 4: ミニグラフ・プレビュー方式（Mini Graph Preview）

### コンセプト

各ノードカードの一部に、そのノードを中心とした小さな関係図（ミニマップ）を埋め込む。
「このアイデアのネットワーク」を視覚的にプレビューする。

### ビジュアル

```
┌─────────────────────────────┐
│ 📝 課題              1日前   │
│ リモートワークの孤立感        │
│ 在宅勤務で雑談がなく...       │
│                             │
│  ┌─────────────────┐        │
│  │   ○──●──○       │        │  ← ミニグラフ
│  │        └──○     │        │    ● = このノード
│  │                 │        │    ○ = 関連ノード
│  └─────────────────┘        │
│  🔗 4件のつながり            │
└─────────────────────────────┘
```

- カード下部に小さな Canvas で関係図を描画
- 中心ノード（●）から放射状に親・子ノード（○）を配置
- エッジ（線）で接続
- 「N件のつながり」ラベルを添える
- タップでマップ画面の該当ノードにジャンプ

### SwiftUI実装イメージ

```swift
struct MiniGraphView: View {
    let centerNode: Node
    let relatedNodes: [Node] // 親 + 子ノード
    let edges: [(String, String)] // (fromId, toId)

    var body: some View {
        Canvas { context, size in
            let center = CGPoint(x: size.width/2, y: size.height/2)
            let radius: CGFloat = min(size.width, size.height) * 0.35

            // 中心ノード
            drawNode(context: context, at: center, isCurrent: true)

            // 関連ノードを円周上に配置
            for (index, _) in relatedNodes.enumerated() {
                let angle = (2 * .pi / Double(relatedNodes.count)) * Double(index)
                let pos = CGPoint(
                    x: center.x + radius * cos(angle),
                    y: center.y + radius * sin(angle)
                )
                drawEdge(context: context, from: center, to: pos)
                drawNode(context: context, at: pos, isCurrent: false)
            }
        }
        .frame(height: 60)
    }
}
```

### 必要なデータ

- 各ノードの親ノード + 子ノードリスト
- HomeViewModel で事前に関連ノード情報をフェッチ

### 長所

- 視覚的インパクトが最も強い。「つながり」のコンセプトを体現
- マップ画面のプレビューとして機能し、マップへの遷移動機になる
- ノード数が多いほどグラフが大きくなり、「盛り上がり」が伝わる

### 短所

- カードの縦サイズが大きくなり、一覧性が低下
- 全ノードの関連データを取得する必要がありAPIコストが高い
- Canvas描画 × LazyVStack でスクロール性能に影響する可能性
- ミニグラフが小さすぎると却って分かりにくい
- 実装コスト・メンテコストが高い

### マップ画面との連携

- ミニグラフのビジュアルをマップと完全統一（色、ノード形状、エッジスタイル）
- ミニグラフタップ → マップの該当クラスタにシームレス遷移（shared element transition）

### ペルソナ評価

中村大輔にとって：
- **良い点**: 「見て楽しい」要素が強く、マップへの好奇心を刺激する
- **懸念**: 情報密度が高く、「軽く眺める」体験を損なう。初回はインパクトがあるが日常利用では邪魔に感じる可能性

---

## 提案 5: ブレッドクラム＋展開方式（Breadcrumb + Expand）

### コンセプト

カードの上部に派生元への「パンくずリスト」を表示し、
下部に子ノードを展開できるボタンを配置する。
Webのパンくずナビゲーションのような直感的表現。

### ビジュアル

```
  課題: リモートの孤立感 › このアイデア  ← パンくず（派生元の場合）
┌─────────────────────────────┐
│ 💡 アイデア          3時間前  │
│ 雑談チャンネル自動生成ツール   │
│ 曜日ごとにランダムで...       │
│                             │
│ 💬 5   👍 12   ↓ 派生 2件 ▸ │  ← 統計行に派生展開を統合
└─────────────────────────────┘
     ▾ 派生を表示（タップで展開）
     ┌───────────────────────┐
     │ 💡 Slack bot版         │  ← コンパクト子ノード
     │ 💡 Teams連携版         │
     └───────────────────────┘
```

- **上部パンくず**: `parentNodeId != nil` の場合、派生元タイトルを1行で表示
- **下部展開**: 子ノードがある場合、統計行に「↓ 派生 N件 ▸」を追加
- パンくずタップ → 派生元の詳細画面へ遷移
- 展開ボタンタップ → カード下に子ノードリストをインライン表示

### SwiftUI実装イメージ

```swift
VStack(spacing: 0) {
    // パンくず（派生元がある場合）
    if let parentTitle = parentNodeTitle {
        Button(action: { navigateToParent() }) {
            HStack(spacing: 4) {
                Text(parentTitle)
                    .lineLimit(1)
                Image(systemName: "chevron.right")
                Text("このアイデア")
                    .fontWeight(.semibold)
            }
            .font(.caption2)
            .foregroundColor(.secondary)
        }
        .padding(.horizontal, 14)
        .padding(.top, 6)
    }

    // カード本体
    NodeCardView(node: node)

    // 子ノード展開
    if childCount > 0 {
        ExpandableChildList(children: children)
    }
}
```

### 必要なデータ

- 親ノードのタイトル（`parentNodeTitle: String?`）
- 子ノードのリスト（id + タイトル）
- HomeViewModel で親タイトル・子ノード概要を同時取得

### 長所

- 派生元の文脈が見え、「何から生まれたアイデアか」がリスト上で分かる
- 展開は任意なので、デフォルトのリスト一覧性を保てる
- パンくずは Web/アプリで広く使われるパターンで学習コストが低い
- ソート順への影響が少ない（各カードは独立して並べられる）

### 短所

- パンくずが長い場合（3段以上の派生チェーン）の表示が難しい
- 親ノードのタイトル取得にAPI追加が必要
- 展開UIがスレッドグルーピング方式と似ており、差別化が弱い

### マップ画面との連携

- パンくずのパス ＝ マップ上のエッジパスに対応
- パンくず全体をタップ → マップでそのパスをハイライト表示

### ペルソナ評価

中村大輔にとって：
- **良い点**: 「これは○○の課題から生まれたアイデアか」が見え、文脈理解しやすい。派生投稿の動機づけになる
- **懸念**: 特になし。情報量のバランスが良い

---

## 比較マトリクス

| 評価軸 | 1. バッジ | 2. スレッド | 3. ライン | 4. ミニグラフ | 5. パンくず |
|--------|----------|-----------|----------|------------|-----------|
| **実装難度** | ★☆☆☆ | ★★☆☆ | ★★★☆ | ★★★☆ | ★★☆☆ |
| **一覧性の維持** | ◎ | ○ | △ | △ | ○ |
| **関係の可視度** | △ | ○ | ◎ | ◎ | ○ |
| **ソート自由度** | ◎ | △ | ✕ | ◎ | ◎ |
| **スクロール性能** | ◎ | ◎ | ○ | △ | ◎ |
| **マップ連携** | ○ | ○ | ◎ | ◎ | ○ |
| **ペルソナ適合** | ○ | ○ | ○ | △ | ◎ |
| **段階的エンゲージメント** | △ | ◎ | ○ | ○ | ◎ |

### 評価基準の説明

- **実装難度**: 少ない★ほど簡単
- **一覧性の維持**: カード表示の高さ・密度を保てるか
- **関係の可視度**: 派生関係の構造がどれだけ伝わるか
- **ソート自由度**: 新着順・人気順などのソートと共存できるか
- **スクロール性能**: LazyVStack内での描画パフォーマンス
- **マップ連携**: マップ画面のビジュアルとの統一感・遷移の自然さ
- **ペルソナ適合**: 中村大輔（31歳エンジニア）の「軽い関与」スタイルに合うか
- **段階的エンゲージメント**: 閲覧→リアクション→派生投稿への動線

---

## 推奨

### Phase1 推奨: 提案5（ブレッドクラム＋展開）or 提案1+5 ハイブリッド

**理由**:

1. **ソート自由度を維持**: ホーム画面の「新着/課題/アイデア/自分」タブ × ソート切替を壊さない
2. **文脈が見える**: パンくずで「何から派生したか」が一覧で分かる — これが InspireHub の肝
3. **一覧性を保つ**: デフォルトは折りたたみで既存UXを損なわない
4. **ペルソナ適合**: 「軽く眺めて、気になったら深掘り」のフローに最適
5. **実装コストが適正**: ★★☆☆ で Phase1 に収まる

### 段階的導入案

```
Phase1-初期: 提案1（バッジ）のみ実装
  ↓ ユーザーフィードバック収集
Phase1-改善: 提案5（パンくず＋展開）を追加
  ↓ マップ画面のビジュアル確定後
Phase2:     マップ連携（タップで該当クラスタへジャンプ）
```

最小コストでまずバッジを入れ、フィードバックを見てからパンくず方式に拡張するアプローチも有効。

---

## API追加要件（いずれの案でも共通）

現在の `HomeViewModel.loadNodes()` が返す `Node` には以下が不足:

| フィールド | 現在 | 必要 | 用途 |
|-----------|------|------|------|
| `parentNodeId` | ✅ あり | ✅ | 派生元の判定 |
| `parentNodeTitle` | ❌ なし | 提案2,5で必要 | パンくず・スレッド表示 |
| `childCount` | ❌ なし | 提案1,2,3,5で必要 | 派生件数バッジ |
| `childNodes` | ❌ なし | 提案2,3,4で必要 | スレッド・ライン・グラフ |

**最小追加**: `childCount: Int` をAPIレスポンスに追加（全提案で有用）
**推奨追加**: `parentNodeTitle: String?` + `childCount: Int`
